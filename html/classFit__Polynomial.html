<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Xmipp: Fit_Polynomial Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="xmipp_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Xmipp
   &#160;<span id="projectnumber">v20.07</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="classFit__Polynomial-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">Fit_Polynomial Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Inheritance diagram for Fit_Polynomial:</div>
<div class="dyncontent">
<div class="center"><img src="classFit__Polynomial__inherit__graph.png" border="0" usemap="#Fit__Polynomial_inherit__map" alt="Inheritance graph"/></div>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for Fit_Polynomial:</div>
<div class="dyncontent">
<div class="center"><img src="classFit__Polynomial__coll__graph.png" border="0" usemap="#Fit__Polynomial_coll__map" alt="Collaboration graph"/></div>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a2b523dd4311f9ce7144d7e0e9df143cd"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classFit__Polynomial.html#a2b523dd4311f9ce7144d7e0e9df143cd">setup</a> (String arg, ImagePlus imp)</td></tr>
<tr class="separator:a2b523dd4311f9ce7144d7e0e9df143cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab9d281ec666272ff277e074c153e32f4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classFit__Polynomial.html#ab9d281ec666272ff277e074c153e32f4">showDialog</a> (ImagePlus imp, String command, PlugInFilterRunner pfr)</td></tr>
<tr class="separator:ab9d281ec666272ff277e074c153e32f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a307ece1ca1190588ae23becabb35bec0"><td class="memItemLeft" align="right" valign="top">boolean&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classFit__Polynomial.html#a307ece1ca1190588ae23becabb35bec0">dialogItemChanged</a> (GenericDialog gd, AWTEvent e)</td></tr>
<tr class="separator:a307ece1ca1190588ae23becabb35bec0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad1799fc1bb4d1f25c164fcd2cc63071c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classFit__Polynomial.html#ad1799fc1bb4d1f25c164fcd2cc63071c">run</a> (ImageProcessor ip)</td></tr>
<tr class="separator:ad1799fc1bb4d1f25c164fcd2cc63071c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a96358caef4065c5612b1da9d4d77d6c9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classFit__Polynomial.html#a96358caef4065c5612b1da9d4d77d6c9">setNPasses</a> (int nPasses)</td></tr>
<tr class="separator:a96358caef4065c5612b1da9d4d77d6c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:a18e2385d66983df456f1ef0cb4b4f033"><td class="memItemLeft" align="right" valign="top">static boolean&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classFit__Polynomial.html#a18e2385d66983df456f1ef0cb4b4f033">invertSymmetricMatrix</a> (double[][] matrix)</td></tr>
<tr class="separator:a18e2385d66983df456f1ef0cb4b4f033"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This plugin-filter fits a polynomial of variable order to an image. The selection (if any) determines the image area the polynomial is fitted to. Output can be the polynomial fit or the image with the fit subtracted. Output area is always the whole image, irrespective of the selection.</p>
<p>The order of the polynomial can be selected separarely for x, y and mixed terms. E.g. with orders 2, 3, and 2 for x, y, and xy, respectively, the polynomial will be a + b*x + c*x^2 + d*y + e*y^2 + f*y^3 + g*xy (note that the lowest-order mixed term, xy, has order 2)</p>
<p>"Output Fit (Don't Subtract)" determines whether the output should be the polynomial function. If unchecked, the polynomial is subtracted from the image.</p>
<p>"Shift Values to Display Range" uses the mean value of the current display range, (max+min)/2, as zero for the subtracted output image. If unchecked, zero output corresponds to 128 for 8-bit and RGB, 32768 for 16-bit and 0 for float images. This option has no effect if "Output Fit (Don't Subtract)" is checked.</p>
<p>For 8-bit and 16-bit images with no or linear calibration, the image will be calibrated by shifting the zero value appropriately.</p>
<p>Restrictions:</p><ul>
<li>Undo will revert only the image contents, not the calibration.</li>
<li>In some cases (some non-rectangular rois and/or very high order of the polynomials), the fit may fail although mathematically possible or produce no "Fit failed" message although there are not enough points for the given order of the polynomial.</li>
</ul>
<p>Hints for usage:</p><ul>
<li>To exclude particles or other foreground objects from the fit, select a threshold to include the background only, then run Edit&gt;Selection&gt;Create Selection to restrict the fit to the selection (i.e., to the background).</li>
<li>For subtracting the background of 8-bit, 16-bit and RGB images, saturation of the output can be avoided by setting "Brightness&amp;Contrast" to such values that desired background level is in the middle of the displayed range, and selecting "Shift Values
to Display Range". Example: For an 8-bit image with background values around 30 and no significant area of foreground objects in the selection, set a display range of 0-60 before running the filter, and check "Shift Values to Display Range".</li>
</ul>
<p>This plugin-filter requires ImageJ 1.38u, which provides provisions for preview.</p>
<p>Version 2007-Jul-13 Michael Schmid </p>

<p>Definition at line <a class="el" href="Fit__Polynomial_8java_source.html#l00065">65</a> of file <a class="el" href="Fit__Polynomial_8java_source.html">Fit_Polynomial.java</a>.</p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a307ece1ca1190588ae23becabb35bec0"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">boolean Fit_Polynomial.dialogItemChanged </td>
          <td>(</td>
          <td class="paramtype">GenericDialog&#160;</td>
          <td class="paramname"><em>gd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">AWTEvent&#160;</td>
          <td class="paramname"><em>e</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="Fit__Polynomial_8java_source.html#l00135">135</a> of file <a class="el" href="Fit__Polynomial_8java_source.html">Fit_Polynomial.java</a>.</p>
<div class="fragment"><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                                                                   {</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        Vector numericFields = gd.getNumericFields();</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        xOrder = (int)gd.getNextNumber();</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        yOrder = (int)gd.getNextNumber();</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        xyOrder = (int)gd.getNextNumber();</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <span class="keywordflow">if</span> (xOrder &lt; 0 || yOrder &lt; 0 || xyOrder &lt; 0 || xOrder&gt;50 || yOrder&gt;50 || xyOrder&gt;10)</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        outputFit = gd.getNextBoolean();</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        shiftToDisplay = gd.getNextBoolean();</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <span class="keywordflow">if</span> (e!=null &amp;&amp; !(e.getSource() instanceof Checkbox))</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;            matrixCalculated = <span class="keyword">false</span>;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        setOffset();</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    }</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a18e2385d66983df456f1ef0cb4b4f033"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static boolean Fit_Polynomial.invertSymmetricMatrix </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>matrix</em>[][]</td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Invert a symmetric n*n matrix. Returns false on error (singular matrix). Needs a reasonably well-conditioned matrix </p>

<p>Definition at line <a class="el" href="Fit__Polynomial_8java_source.html#l00324">324</a> of file <a class="el" href="Fit__Polynomial_8java_source.html">Fit_Polynomial.java</a>.</p>
<div class="fragment"><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                                                                   {</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        <span class="keywordtype">int</span> n = matrix.length;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        <span class="keywordflow">if</span> (matrix[0].length != n) {</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;            IJ.error(<span class="stringliteral">&quot;invertSymmetricMatrix - not a square matrix&quot;</span>);</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        }</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        <span class="keywordtype">boolean</span>[] processed = <span class="keyword">new</span> <span class="keywordtype">boolean</span>[n];</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        <span class="keywordtype">double</span>[] qq = <span class="keyword">new</span> <span class="keywordtype">double</span>[n];</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        <span class="keywordtype">double</span>[] pp = <span class="keyword">new</span> <span class="keywordtype">double</span>[n];</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        <span class="keywordtype">double</span> pivot0 = 1e-50;           <span class="comment">//absolute value of the first (largest) pivot</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        <span class="comment">//IJ.log(&quot;---invert matrix---&quot;); printMatrix(matrix);</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;n; i++) {       <span class="comment">//loop: process all matrix lines&amp;columns</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;            <span class="keywordtype">double</span> max = pivot0 * 1e-14; <span class="comment">//pivot must be bigger than this</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;            <span class="keywordtype">int</span> iPivot = -1;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;n; j++)     <span class="comment">//find pivot</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                <span class="keywordflow">if</span> (!processed[j]) {</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                    <span class="keywordtype">double</span> abs = matrix[j][j];</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;                    abs = abs&lt;0 ? -abs : abs;<span class="comment">//abs = Math.abs(matrix[j][j]); but faster</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                    <span class="keywordflow">if</span> (abs &gt; max)  {</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                        max = abs;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                        iPivot = j;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                    }</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;            }</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;            <span class="keywordflow">if</span> (iPivot &lt; 0)</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;           <span class="comment">//no pivot large enough, looks singular</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;            <span class="keywordflow">if</span> (i==0)</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                pivot0 = max;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;            processed[iPivot] = <span class="keyword">true</span>;</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;            pp[iPivot] = 1.;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;            <span class="keywordtype">double</span> q = 1./matrix[iPivot][iPivot];</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;            qq[iPivot] = q;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;            matrix[iPivot][iPivot] = 0.;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;iPivot; j++) {</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                pp[j] = matrix[j][iPivot];</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;                qq[j] = matrix[j][iPivot]*q*(processed[j]?1:-1);</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                matrix[j][iPivot] = 0.;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;            }</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=iPivot+1; j&lt;n; j++) {</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                pp[j] = matrix[iPivot][j]*(processed[j]?-1:1);</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                qq[j] = -matrix[iPivot][j]*q;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                matrix[iPivot][j] = 0.;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;            }</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;n; j++)</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=j; k&lt;n; k++)</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;                    matrix[j][k] += pp[j]*qq[k];</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;            <span class="comment">//printMatrix(matrix);</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        } <span class="comment">//for i</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        <span class="comment">//IJ.log(&quot;asymmetric:&quot;);printMatrix(matrix);</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=1; i&lt;n; i++)         <span class="comment">//fill bottom left to make symmetric again</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;i; j++)</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                matrix[i][j] = matrix[j][i];</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        <span class="comment">//IJ.log(&quot;result:&quot;);printMatrix(matrix);</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    }</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad1799fc1bb4d1f25c164fcd2cc63071c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Fit_Polynomial.run </td>
          <td>(</td>
          <td class="paramtype">ImageProcessor&#160;</td>
          <td class="paramname"><em>ip</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>This method is invoked for each slice and color channel during execution. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ip</td><td>The image subject to filtering. Since the CONVERT_TO_FLOAT flag is set, <code>ip</code> is always a FloatProcessor. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="Fit__Polynomial_8java_source.html#l00188">188</a> of file <a class="el" href="Fit__Polynomial_8java_source.html">Fit_Polynomial.java</a>.</p>
<div class="fragment"><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                                       {</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        Rectangle roi = ip.getRoi();</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        <span class="keywordtype">int</span> width = ip.getWidth();</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        <span class="keywordtype">int</span> height = ip.getHeight();</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        <span class="keywordtype">float</span>[] pixels = (<span class="keywordtype">float</span>[])ip.getPixels();</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        byte[] mask = ip.getMaskArray();</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        Thread thread = Thread.currentThread();</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        <span class="keyword">synchronized</span>(<span class="keyword">this</span>) {</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;            <span class="keywordflow">if</span> (!matrixCalculated) {</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                matrixCalculated = <span class="keyword">true</span>;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;                calculateMatrixEtc(ip);</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                <span class="keywordflow">if</span> (matrix == null)</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                    IJ.error(<span class="stringliteral">&quot;Fit failed, use lower order.&quot;</span>);</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;            }</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        }</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        <span class="keywordflow">if</span> (matrix==null || thread.isInterrupted()) <span class="keywordflow">return</span>;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        <span class="keywordtype">double</span>[] vector = <span class="keyword">new</span> <span class="keywordtype">double</span>[baseSize];         <span class="comment">//calculate fit</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        <span class="keywordtype">long</span> lastTime = System.currentTimeMillis();</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y=roi.y, powerY=y*endPower; y&lt;roi.y+roi.height; y++, powerY+=endPower) {</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;            <span class="keywordtype">long</span> time = System.currentTimeMillis();</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;            <span class="keywordflow">if</span> (time-lastTime &gt; 100) {</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                lastTime = time;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                <span class="keywordflow">if</span> (thread.isInterrupted()) <span class="keywordflow">return</span>;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                showProgress((y-roi.y)/(<span class="keywordtype">double</span>)(roi.height));</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;            }</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x=roi.x, p=width*y+x, m=(y-roi.y)*roi.width, powerX=x*endPower; x&lt;roi.x+roi.width; x++, p++, m++, powerX+=endPower)</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                <span class="keywordflow">if</span> (mask == null || mask[m] != 0)</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iBase=0; iBase&lt;baseSize; iBase++)</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                        vector[iBase] += pixels[p]*</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;                                powerOfX[powerX+xPower[iBase]]*powerOfY[powerY+yPower[iBase]];</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                    <span class="comment">//for iBase</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                <span class="comment">//if inside mask</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;            <span class="comment">//for x</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        } <span class="comment">//for y</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        pass++;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        <span class="keywordtype">double</span>[] coeff = <span class="keyword">new</span> <span class="keywordtype">double</span>[baseSize];</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;baseSize; i++)</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;baseSize; j++)</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                coeff[i] += matrix[i][j]*vector[j];</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        <span class="comment">//IJ.log(&quot;coeff:&quot;);printVector(coeff);</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        <span class="comment">//                                              // apply fit</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> y=0, p=0, powerY=0; y&lt;height; y++, powerY+=endPower) {</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;            <span class="keywordtype">long</span> time = System.currentTimeMillis();</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;            <span class="keywordflow">if</span> (time-lastTime &gt; 100) {</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                lastTime = time;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                <span class="keywordflow">if</span> (thread.isInterrupted()) <span class="keywordflow">return</span>;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                showProgress(y/(<span class="keywordtype">double</span>)(height));</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;            }</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x=0, powerX=0; x&lt;width; x++, p++, powerX+=endPower) {</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                <span class="keywordtype">double</span> background = 0.;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iBase=0; iBase&lt;baseSize; iBase++)</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                    background += coeff[iBase]*powerOfX[powerX+xPower[iBase]]*powerOfY[powerY+yPower[iBase]];</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                <span class="keywordflow">if</span> (outputFit)</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                    pixels[p] = (float)background;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                    pixels[p] += offset - (float)background;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;            } <span class="comment">//for x</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        } <span class="comment">//for y</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        pass++;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    }</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a96358caef4065c5612b1da9d4d77d6c9"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Fit_Polynomial.setNPasses </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nPasses</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>This method is called by ImageJ to set the number of calls to run(ip) corresponding to 100% of the progress bar </p>

<p>Definition at line <a class="el" href="Fit__Polynomial_8java_source.html#l00380">380</a> of file <a class="el" href="Fit__Polynomial_8java_source.html">Fit_Polynomial.java</a>.</p>
<div class="fragment"><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                                         {</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        this.nPasses = 2*nPasses; <span class="comment">//one pass for fitting, one for subtracting</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        <span class="keywordflow">if</span> (!matrixCalculated) this.nPasses += MAKE_MATRIX_PASSES; <span class="comment">//+time for making the matrix</span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        pass = 0;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    }</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a2b523dd4311f9ce7144d7e0e9df143cd"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int Fit_Polynomial.setup </td>
          <td>(</td>
          <td class="paramtype">String&#160;</td>
          <td class="paramname"><em>arg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ImagePlus&#160;</td>
          <td class="paramname"><em>imp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="Fit__Polynomial_8java_source.html#l00105">105</a> of file <a class="el" href="Fit__Polynomial_8java_source.html">Fit_Polynomial.java</a>.</p>
<div class="fragment"><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                                                {</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        <span class="keywordflow">if</span> (arg.equals(<span class="stringliteral">&quot;final&quot;</span>) &amp;&amp; !outputFit) {</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;            setCalibration();              <span class="comment">//at the very end: calibration (non-float images)</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;            <span class="keywordflow">return</span> DONE;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;            <span class="keywordflow">if</span> (IJ.versionLessThan(<span class="stringliteral">&quot;1.38u&quot;</span>)) <span class="comment">// generates an error message for older versions</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;                <span class="keywordflow">return</span> DONE;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;            this.imp = imp;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;            <span class="keywordflow">return</span> flags;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        }</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    }</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ab9d281ec666272ff277e074c153e32f4"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int Fit_Polynomial.showDialog </td>
          <td>(</td>
          <td class="paramtype">ImagePlus&#160;</td>
          <td class="paramname"><em>imp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">String&#160;</td>
          <td class="paramname"><em>command</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PlugInFilterRunner&#160;</td>
          <td class="paramname"><em>pfr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Ask the user for the parameters </p>

<p>Definition at line <a class="el" href="Fit__Polynomial_8java_source.html#l00119">119</a> of file <a class="el" href="Fit__Polynomial_8java_source.html">Fit_Polynomial.java</a>.</p>
<div class="fragment"><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                                                                                 {</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        GenericDialog gd = <span class="keyword">new</span> GenericDialog(command);</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        gd.addSlider(<span class="stringliteral">&quot;x Direction: Order&quot;</span>, 0., 10., xOrder);</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        gd.addSlider(<span class="stringliteral">&quot;y Direction: Order&quot;</span>, 0., 10., yOrder);</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        gd.addSlider(<span class="stringliteral">&quot;mixed xy: Order&quot;</span>, 0., 10., xyOrder);</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        gd.addCheckbox(<span class="stringliteral">&quot;Output Fit (Don&#39;t Subtract)&quot;</span>, outputFit);</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        gd.addCheckbox(<span class="stringliteral">&quot;Shift Values to Display Range&quot;</span>, shiftToDisplay);</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        gd.addPreviewCheckbox(pfr);</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        gd.addDialogListener(<span class="keyword">this</span>);</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        gd.addHelp(<span class="stringliteral">&quot;http://imagejdocu.tudor.lu/doku.php?id=plugin:filter:fit_polynomial:start&quot;</span>);</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        gd.showDialog();                    <span class="comment">//input by the user (or macro) happens here</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        <span class="keywordflow">if</span> (gd.wasCanceled()) <span class="keywordflow">return</span> DONE;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        IJ.register(this.getClass());       <span class="comment">//protect static class variables (filter parameters) from garbage collection</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        <span class="keywordflow">return</span> IJ.setupDialog(imp, flags);  <span class="comment">//ask whether to process all slices of stack (if a stack)</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    }</div></div><!-- fragment -->
</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>xmippViz/external/imagej/plugins/Filters/<a class="el" href="Fit__Polynomial_8java_source.html">Fit_Polynomial.java</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
